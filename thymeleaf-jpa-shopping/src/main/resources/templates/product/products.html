<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Danh s√°ch s·∫£n ph·∫©m</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* ----- Layout chung, kh√¥ng thay ƒë·ªïi m√†u ----- */
        .page-container{max-width:1200px;margin:24px auto;padding:0 16px}

        /* Header g·ªçn, canh l·ªÅ ƒë·∫πp h∆°n, kh√¥ng ƒë·ª•ng m√†u */
        .products-header{
            display:grid;gap:16px;align-items:center;
            grid-template-columns:1fr auto auto;
            padding:16px;border-radius:12px;border:1px solid currentColor; 
            border-color: transparent; /* tr√°nh l·ªô m√†u vi·ªÅn n·∫øu theme kh√¥ng c√≥ */
        }
        .page-title{margin:0;line-height:1.2;font-size:28px}
        .page-subtitle{margin:4px 0 0;font-size:14px;opacity:.85}

        /* Form l·ªçc: gi√£n ƒë·ªÅu, kh√¥ng ƒë·ªïi m√†u input/button */
        .filter-form{display:flex;gap:10px;align-items:center;justify-content:flex-end}
        .filter-form input{
            flex:1;min-width:220px;height:40px;border-radius:10px;padding:0 12px;
            border:1px solid rgba(0,0,0,.15);outline:none
        }
        .btn{height:40px;padding:0 14px;border-radius:10px;display:inline-flex;align-items:center;gap:8px;font-weight:600}

        /* Tr·∫°ng th√°i r·ªóng */
        .empty-state{margin-top:16px;padding:40px 16px;border-radius:12px;border:1px dashed rgba(0,0,0,.15);text-align:center}

        /* L∆∞·ªõi s·∫£n ph·∫©m linh ho·∫°t */
        .product-grid{
            display:grid;gap:16px;margin-top:16px;
            grid-template-columns:repeat(auto-fill,minmax(250px,1fr))
        }

        /* Card: ch·ªâ ch·ªânh k√≠ch th∆∞·ªõc/ƒë·ªï b√≥ng/hover; kh√¥ng set m√†u n·ªÅn/ch·ªØ */
        .product-card{
            position:relative;display:flex;flex-direction:column;
            border-radius:16px;overflow:hidden;min-height:360px;
            transition:transform .18s ease, box-shadow .18s ease;
            cursor:pointer;border:1px solid rgba(0,0,0,.08)
        }
        .product-card:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.15)}

        /* V√πng media gi·ªØ t·ªâ l·ªá 4:3; kh√¥ng set m√†u n·ªÅn */
        .product-media{position:relative;width:100%;aspect-ratio:4/3}
        @supports not (aspect-ratio: 4 / 3){
            .product-media{padding-top:66.666%}
        }
        .product-media img,.product-media div{
            position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
            display:flex;align-items:center;justify-content:center;font-size:48px
        }

        .product-card__body{display:flex;flex-direction:column;gap:12px;padding:14px;flex:1}
        .product-card__meta{display:flex;gap:8px;flex-wrap:wrap}
        .badge{display:inline-flex;align-items:center;gap:6px;height:26px;padding:0 10px;border-radius:999px;font-size:12px}

        .product-card__price{margin-top:auto;font-size:20px;font-weight:800;letter-spacing:.2px}
        .product-card__actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
        .product-card .btn{height:36px}

        /* Responsive header */
        @media (max-width: 900px){
            .products-header{grid-template-columns:1fr}
            .filter-form{justify-content:stretch}
        }
    </style>
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="page-container">
    <div class="products-header">
        <div>
            <h1 class="page-title">Danh s√°ch s·∫£n ph·∫©m</h1>
        </div>

        <form th:action="@{/products/search}" method="get" class="filter-form" style="grid-column: span 2;">
            <input name="name" type="text" placeholder="T√¨m s·∫£n ph·∫©m theo t√™n">
            <button type="submit" class="btn btn-outline">T√¨m ki·∫øm</button>
            <a th:href="@{/products}" class="btn btn-ghost">T·∫•t c·∫£</a>
            <div sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/products/new}" class="btn btn-primary">+ S·∫£n ph·∫©m m·ªõi</a>
            </div>
        </form>
    </div>

    <div th:if="${#lists.isEmpty(products)}" class="empty-state">
        <p>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</p>
        <div sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/products/new}" class="btn btn-primary">Th√™m s·∫£n ph·∫©m ƒë·∫ßu ti√™n</a>
        </div>
    </div>

    <div class="product-grid" th:if="${!#lists.isEmpty(products)}">
        <div class="product-card"
             th:each="product : ${products}"
             th:attr="data-href=@{/products/{id}(id=${product.productId})}"
             role="link" tabindex="0" aria-label="Xem chi ti·∫øt [[${product.name}]]">

            <div class="product-media">
                <img th:if="${product.imageUrl != null && !product.imageUrl.isEmpty()}"
                     th:src="${product.imageUrl}" alt="·∫¢nh s·∫£n ph·∫©m">
                <div th:unless="${product.imageUrl != null && !product.imageUrl.isEmpty()}">üõçÔ∏è</div>
            </div>

            <div class="product-card__body">
                <div>
                    <h3 th:text="${product.name}" style="margin:0 0 6px;font-size:16px;font-weight:700;"></h3>
                    <p class="page-subtitle" style="margin:0;"
                       th:text="${product.description == null || #strings.isEmpty(product.description) ? 'Ch∆∞a c√≥ m√¥ t·∫£' : product.description}"></p>
                </div>

                <div class="product-card__meta">
                    <span class="badge"
                          th:classappend="${product.inStock ? ' badge-success' : ' badge-danger'}"
                          th:text="${product.inStock ? 'C√≤n h√†ng' : 'H·∫øt h√†ng'}"></span>
                    <span class="badge badge-info"
                          th:text="${'T·ªìn kho: ' + (product.stock != null ? product.stock : 0)}"></span>
                </div>

                <div class="product-card__price"
                     th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></div>

                <div class="product-card__actions no-card-nav">
                    <!-- B·ªé n√∫t 'Chi ti·∫øt'; to√†n b·ªô card l√† link -->
                    <form th:action="@{/cart/add/{id}(id=${product.productId})}" method="post" class="no-card-nav">
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="btn btn-primary" th:disabled="${!product.inStock}">Th√™m v√†o gi·ªè</button>
                    </form>

                    <div sec:authorize="hasRole('ADMIN')" style="display:flex; gap:8px; flex-wrap:wrap;">
                        <a th:href="@{/products/edit/{id}(id=${product.productId})}" class="btn btn-ghost no-card-nav">Ch·ªânh s·ª≠a</a>
                        <form th:action="@{/products/delete}" method="post"
                              onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?');" class="no-card-nav">
                            <input type="hidden" name="id" th:value="${product.productId}">
                            <button type="submit" class="btn btn-danger">X√≥a</button>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Include Chatbot -->
<div th:replace="~{fragments/chatbot :: chatbot}"></div>

<script>
    // ƒêi·ªÅu h∆∞·ªõng khi click card, tr·ª´ c√°c v√πng t∆∞∆°ng t√°c
    document.addEventListener('click', function (e) {
        const card = e.target.closest('.product-card');
        if (!card) return;
        const stop = e.target.closest('.no-card-nav, a, button, input, select, textarea, label');
        if (stop) return;
        const href = card.getAttribute('data-href');
        if (href) window.location.href = href;
    });

    // H·ªó tr·ª£ Enter khi focus v√†o card (a11y)
    document.addEventListener('keydown', function (e) {
        if (e.key !== 'Enter') return;
        const card = e.target.closest('.product-card[tabindex="0"]');
        if (!card) return;
        const href = card.getAttribute('data-href');
        if (href) window.location.href = href;
    });
</script>

</body>
</html>
