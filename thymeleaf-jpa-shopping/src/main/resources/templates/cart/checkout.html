<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Thanh to√°n</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    
    <div class="page-container">
        <div class="page-header">
            <div>
                <h1 class="page-title">üí≥ Thanh to√°n ƒë∆°n h√†ng</h1>
                <p class="page-subtitle">Ki·ªÉm tra th√¥ng tin v√† ho√†n t·∫•t ƒë·∫∑t h√†ng trong m·ªôt b∆∞·ªõc.</p>
            </div>
        </div>

        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        
        <div class="checkout-layout">
            <section class="order-summary-card">
                <h2 class="page-title" style="font-size:22px;">Chi ti·∫øt ƒë∆°n h√†ng</h2>
                <p class="page-subtitle">Ki·ªÉm tra l·∫ßn cu·ªëi c√°c s·∫£n ph·∫©m trong gi·ªè c·ªßa b·∫°n.</p>
                
                <div class="table-scroll" style="margin-top:var(--space-4);">
                    <table>
                        <thead>
                            <tr>
                                <th>S·∫£n ph·∫©m</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>ƒê∆°n gi√°</th>
                                <th>T·ªïng</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="item : ${cartItems}">
                                <td th:text="${item.productName}"></td>
                                <td th:text="${item.quantity}"></td>
                                <td th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                                <td th:text="${#numbers.formatDecimal(item.subtotal, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" style="text-align:right;">T·ªïng c·ªông</td>
                                <td th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <ul class="order-breakdown" style="margin-top:var(--space-5);">
                    <li>
                        <span>T·∫°m t√≠nh</span>
                        <span th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span>
                    </li>
                    <li>
                        <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                        <span>Mi·ªÖn ph√≠</span>
                    </li>
                    <li style="border-top:1px solid var(--border-light); padding-top:var(--space-3); font-size:18px;">
                        <span>T·ªïng thanh to√°n</span>
                        <span th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span>
                    </li>
                </ul>
            </section>
            
            <section class="page-section">
                <h2 style="margin-top:0;">Th√¥ng tin giao h√†ng</h2>
                <p class="page-subtitle">Ch√∫ng t√¥i s·∫Ω s·ª≠ d·ª•ng th√¥ng tin n√†y ƒë·ªÉ li√™n l·∫°c khi giao h√†ng.</p>

                <form th:action="@{/cart/checkout}" th:object="${orderDTO}" method="post">
                    <div class="form-group">
                        <label for="shippingAddress">ƒê·ªãa ch·ªâ giao h√†ng *</label>
                        <textarea id="shippingAddress"
                                  class="form-control"
                                  th:field="*{shippingAddress}"
                                  th:classappend="${#fields.hasErrors('shippingAddress')} ? 'error' : ''"
                                  rows="3"
                                  required
                                  placeholder="V√≠ d·ª•: 123 L√Ω Th∆∞·ªùng Ki·ªát, P.7, Q.10, TP.HCM"></textarea>
                        <span class="form-hint">H√£y ghi r√µ s·ªë nh√†, ph∆∞·ªùng/x√£ v√† qu·∫≠n/huy·ªán.</span>
                        <span class="field-error" th:if="${#fields.hasErrors('shippingAddress')}" 
                              th:errors="*{shippingAddress}"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá *</label>
                        <input type="tel"
                               id="phone"
                               class="form-control"
                               th:field="*{phone}"
                               th:classappend="${#fields.hasErrors('phone')} ? 'error' : ''"
                               required
                               placeholder="0912 345 678">
                        <span class="form-hint">Nh√¢n vi√™n giao h√†ng s·∫Ω li√™n h·ªá qua s·ªë n√†y khi c·∫ßn.</span>
                        <span class="field-error" th:if="${#fields.hasErrors('phone')}" 
                              th:errors="*{phone}"></span>
                    </div>
                    
                    <div class="form-actions" style="justify-content:space-between;">
                        <a th:href="@{/cart}" class="btn btn-ghost">‚Üê Quay l·∫°i gi·ªè h√†ng</a>
                        <button type="submit" class="btn btn-primary btn-lg">X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
                    </div>
                </form>
            </section>
        </div>
    </div>

    <!-- Include Chatbot -->
    <div th:replace="~{fragments/chatbot :: chatbot}"></div>

</body>
</html>
