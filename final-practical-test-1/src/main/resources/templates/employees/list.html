<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:replace="~{layout}">
<body>
<div th:fragment="content">
    <h2>Employees</h2>
    <a th:href="@{/employees/new}" class="btn btn-primary mb-2" sec:authorize="hasRole('ADMIN')">Add New</a>
    
    <form th:action="@{/employees}" method="get" class="mb-2">
        <input type="text" name="q" th:value="${keyword}" placeholder="Search...">
        <select name="departmentId">
            <option value="">All Departments</option>
            <option th:each="d : ${departments}" th:value="${d.id}" th:text="${d.name}" th:selected="${d.id == departmentId}"></option>
        </select>
        <button type="submit">Search</button>
    </form>

    <table class="table table-bordered">
        <tr><th>Name</th><th>Email</th><th>Department</th><th>Salary</th><th>Active</th><th>Actions</th></tr>
        <tr th:each="e : ${employees}">
            <td th:text="${e.fullName}"></td>
            <td th:text="${e.email}"></td>
            <td th:text="${e.department.name}"></td>
            <td th:text="${e.salary}"></td>
            <td th:text="${e.active ? 'Yes' : 'No'}"></td>
            <td>
                <a th:href="@{/employees/{id}(id=${e.id})}">Detail</a>
                <a th:href="@{/employees/{id}/edit(id=${e.id})}" sec:authorize="hasRole('ADMIN')">Edit</a>
            </td>
        </tr>
    </table>
    
    <div th:if="${employees.totalPages > 1}">
        <a th:if="${!employees.first}" th:href="@{/employees(q=${keyword},departmentId=${departmentId},page=${employees.number-1})}">Prev</a>
        <span th:text="'Page ' + ${employees.number+1} + ' of ' + ${employees.totalPages}"></span>
        <a th:if="${!employees.last}" th:href="@{/employees(q=${keyword},departmentId=${departmentId},page=${employees.number+1})}">Next</a>
    </div>
</div>
</body>
</html>
