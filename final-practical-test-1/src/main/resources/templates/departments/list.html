<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:replace="~{layout}">
<body>
<div th:fragment="content">
    <h2>Departments</h2>
    <a th:href="@{/departments/new}" class="btn btn-primary mb-2" sec:authorize="hasRole('ADMIN')">Add New</a>
    
    <form th:action="@{/departments}" method="get" class="mb-2">
        <input type="text" name="q" th:value="${keyword}" placeholder="Search...">
        <button type="submit">Search</button>
    </form>

    <table class="table table-bordered">
        <tr><th>Code</th><th>Name</th><th>Description</th><th>Employees</th><th>Actions</th></tr>
        <tr th:each="d : ${departments}">
            <td th:text="${d.code}"></td>
            <td th:text="${d.name}"></td>
            <td th:text="${d.description}"></td>
            <td th:text="${d.employees?.size() ?: 0}"></td>
            <td>
                <a th:href="@{/departments/{id}(id=${d.id})}" sec:authorize="hasAnyRole('ADMIN', 'EMPLOYEE')">Detail</a>
                <a th:href="@{/departments/{id}/edit(id=${d.id})}" sec:authorize="hasRole('ADMIN')">Edit</a>
            </td>
        </tr>
    </table>
    
    <div th:if="${departments.totalPages > 1}">
        <a th:if="${!departments.first}" th:href="@{/departments(q=${keyword},page=${departments.number-1})}">Prev</a>
        <span th:text="'Page ' + ${departments.number+1} + ' of ' + ${departments.totalPages}"></span>
        <a th:if="${!departments.last}" th:href="@{/departments(q=${keyword},page=${departments.number+1})}">Next</a>
    </div>
</div>
</body>
</html>
